<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>เข้าสู่ระบบ | โรงเรียนอุบลบุรีรักษ์การบริบาล</title>

<style>
  :root {
    --pink:#ff6fb5;
    --blue:#0d6efd;
    --green:#20c997;
    --bg:#f7f7ff;
  }
  body {
    margin:0;
    font-family:Arial, sans-serif;
    background:linear-gradient(135deg,#ffe3f2,#e7f2ff,#eafff5);
  }
  header {
    background:linear-gradient(120deg,var(--pink),var(--blue),var(--green));
    padding:16px;
    text-align:center;
    color:#fff;
    box-shadow:0 2px 10px rgba(0,0,0,0.15);
  }
  .logo {
    width:60px;
    height:60px;
    border-radius:50%;
    background:white;
    padding:5px;
    margin-bottom:5px;
  }
  main {
    max-width:420px;
    margin:30px auto;
    background:white;
    padding:25px;
    border-radius:12px;
    box-shadow:0 4px 15px rgba(0,0,0,0.1);
  }
  h2{text-align:center;margin-top:0;color:#333;}
  label {font-weight:bold;font-size:14px;margin-bottom:3px;display:block;}
  input {
    width:100%;padding:10px;border:1px solid #ccc;
    border-radius:8px;margin-top:4px;font-size:14px;
  }
  .btn {
    width:100%;padding:12px;margin-top:12px;
    border:none;border-radius:999px;
    background:linear-gradient(135deg,var(--blue),var(--green));
    color:white;font-weight:bold;font-size:16px;
    cursor:pointer;
  }
  .btn:hover {opacity:0.9;}
  .link {
    text-align:center;margin-top:12px;font-size:13px;
  }
  .link a {color:var(--blue);text-decoration:none;}
  .error {color:red;font-size:13px;margin-top:10px;text-align:center;}
  .success {color:green;font-size:13px;margin-top:10px;text-align:center;}
</style>

</head>
<body>

<header>
  <img src="https://www.urrschool.com/favicon.ico" class="logo">
  <h1>เข้าสู่ระบบนักศึกษา</h1>
  <p>โรงเรียนอุบลบุรีรักษ์การบริบาล</p>
</header>

<main>

  <h2>เข้าสู่ระบบ</h2>

  <div id="loginMsg"></div>

  <form id="loginForm">
    <label>อีเมล หรือ เลขบัตรประชาชน</label>
    <input type="text" id="loginUser" required>

    <label>รหัสผ่าน</label>
    <input type="password" id="loginPass" required>

    <button class="btn" type="submit">เข้าสู่ระบบ</button>
  </form>

  <div class="link">
    <a href="#" onclick="openRegister()">ยังไม่มีบัญชี? ลงทะเบียน</a><br>
    <a href="#" onclick="openForgot()">ลืมรหัสผ่าน</a><br>
    <a href="index.html">← กลับหน้าแรก</a>
  </div>
</main>

<script>
  const MEMBERS_KEY = "ubr_members";
  const CURRENT_USER_KEY = "ubr_current_user";

  function loadMembers() {
    try {
      return JSON.parse(localStorage.getItem(MEMBERS_KEY) || "[]");
    } catch {
      return [];
    }
  }

  function showMsg(id,msg,type){
    const el=document.getElementById(id);
    el.textContent=msg;
    el.className=type;
  }

  function openRegister(){
    window.location.href="login.html#register";
  }
  function openForgot(){
    window.location.href="login.html#forgot";
  }

  /* ========== LOGIN FORM ========== */
  document.getElementById("loginForm").addEventListener("submit",function(e){
    e.preventDefault();

    const id=document.getElementById("loginUser").value.trim();
    const pw=document.getElementById("loginPass").value;

    if(pw.length<8){
      showMsg("loginMsg","รหัสผ่านต้องไม่น้อยกว่า 8 ตัว","error");
      return;
    }

    const list=loadMembers();
    const user=list.find(m =>
      (m.email===id || m.citizenId===id) && m.password===pw
    );

    if(!user){
      showMsg("loginMsg","ไม่พบบัญชี หรือรหัสผ่านไม่ถูกต้อง","error");
      return;
    }

    if(user.status!=="approved"){
      showMsg("loginMsg","บัญชียังไม่ได้รับการอนุมัติจาก Admin","error");
      return;
    }

    localStorage.setItem(CURRENT_USER_KEY, user.email || user.citizenId);
    showMsg("loginMsg","เข้าสู่ระบบสำเร็จ! กำลังนำทาง...","success");

    setTimeout(()=>window.location.href="index.html",800);
  });
</script>

</body>
</html>

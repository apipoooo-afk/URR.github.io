<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>แดชบอร์ดนักศึกษา | โรงเรียนอุบลบุรีรักษ์การบริบาล</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      background-color: #007bff;
      color: white;
      padding: 16px 10px;
    }
    main {
      max-width: 1100px;
      margin: 24px auto;
      padding: 0 16px 24px 16px;
    }
    h1, h2, h3 {
      margin-top: 0;
    }
    .top-actions {
      margin-bottom: 16px;
    }
    .top-actions a {
      display: inline-block;
      padding: 8px 14px;
      background: #e5e7eb;
      border-radius: 999px;
      text-decoration: none;
      font-size: 0.9rem;
      color: #111827;
      margin-right: 8px;
    }
    .top-actions a:hover {
      background: #d1d5db;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .card {
      background: #ffffff;
      border-radius: 10px;
      padding: 16px 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .card-title {
      font-size: 0.95rem;
      color: #6b7280;
      margin-bottom: 4px;
    }
    .card-value {
      font-size: 1.8rem;
      font-weight: bold;
      color: #111827;
    }
    .card-sub {
      font-size: 0.85rem;
      color: #6b7280;
      margin-top: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      background: #fff;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 8px;
      font-size: 0.9rem;
      text-align: left;
    }
    th {
      background: #f3f4f6;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      color: #fff;
    }
    .badge-new        { background: #6b7280; }
    .badge-learning   { background: #10b981; }
    .badge-intern     { background: #f59e0b; }
    .badge-graduated  { background: #3b82f6; }
    .badge-employed   { background: #8b5cf6; }
  </style>
</head>
<body>
  <header>
    <h1>แดชบอร์ด / ฐานข้อมูลนักศึกษา</h1>
    <p>โรงเรียนอุบลบุรีรักษ์การบริบาล</p>
  </header>

  <main>
    <div class="top-actions">
      <a href="index.html">← กลับหน้าแรก</a>
      <a href="register.html">สมัครเรียนใหม่</a>
      <a href="login.html">เข้าสู่ระบบ</a>
    </div>

    <h2>สรุปภาพรวม</h2>
    <div class="grid">
      <div class="card">
        <div class="card-title">จำนวนครั้งที่เข้าดูเว็บไซต์</div>
        <div class="card-value" id="viewsTotal">0</div>
        <div class="card-sub">นับจากการเปิดหน้า index.html (ในเครื่องนี้)</div>
      </div>

      <div class="card">
        <div class="card-title">ผู้สมัครเรียนทั้งหมด</div>
        <div class="card-value" id="studentsTotal">0</div>
        <div class="card-sub">ข้อมูลจากแบบฟอร์ม register.html</div>
      </div>

      <div class="card">
        <div class="card-title">ผู้ที่เคยล็อกอินแล้ว</div>
        <div class="card-value" id="loggedUsersTotal">0</div>
        <div class="card-sub">นับจากรหัสนักศึกษาที่เคยเข้าสู่ระบบ</div>
      </div>

      <div class="card">
        <div class="card-title">จำนวนครั้งที่ล็อกอิน</div>
        <div class="card-value" id="loginCountTotal">0</div>
        <div class="card-sub">ทุกครั้งที่เข้าสู่ระบบผ่านหน้า login.html</div>
      </div>
    </div>

    <h2>สถานะนักศึกษา</h2>
    <div class="grid">
      <div class="card">
        <div class="card-title">สมัครใหม่</div>
        <div class="card-value" id="newTotal">0</div>
      </div>
      <div class="card">
        <div class="card-title">กำลังเรียนออนไลน์</div>
        <div class="card-value" id="learningTotal">0</div>
      </div>
      <div class="card">
        <div class="card-title">ฝึกงาน</div>
        <div class="card-value" id="internTotal">0</div>
      </div>
      <div class="card">
        <div class="card-title">จบการศึกษา</div>
        <div class="card-value" id="graduatedTotal">0</div>
      </div>
      <div class="card">
        <div class="card-title">บรรจุงานแล้ว</div>
        <div class="card-value" id="employedTotal">0</div>
      </div>
    </div>

    <h3>ตารางฐานข้อมูลนักศึกษา</h3>
    <table id="studentsTable">
      <thead>
        <tr>
          <th>รหัสนักศึกษา</th>
          <th>ชื่อ-นามสกุล</th>
          <th>หลักสูตร</th>
          <th>สถานะ</th>
          <th>วันที่สมัคร</th>
        </tr>
      </thead>
      <tbody>
        <!-- เติมด้วย JS -->
      </tbody>
    </table>
  </main>

  <script>
    const STORAGE_KEY         = "students";
    const VIEW_KEY            = "siteViews";
    const LOGIN_COUNT_KEY     = "loginCount";
    const LOGGED_STUDENTS_KEY = "loggedStudents";

    function loadStudents() {
      return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    }
    function loadLoggedStudents() {
      return JSON.parse(localStorage.getItem(LOGGED_STUDENTS_KEY) || "[]");
    }

    function statusBadgeClass(status) {
      switch (status) {
        case "new":        return "badge badge-new";
        case "learning":   return "badge badge-learning";
        case "intern":     return "badge badge-intern";
        case "graduated":  return "badge badge-graduated";
        case "employed":   return "badge badge-employed";
        default:           return "badge badge-new";
      }
    }

    function statusLabel(status) {
      switch (status) {
        case "new":        return "สมัครใหม่";
        case "learning":   return "กำลังเรียนออนไลน์";
        case "intern":     return "ฝึกงาน";
        case "graduated":  return "จบการศึกษา";
        case "employed":   return "บรรจุงานแล้ว";
        default:           return status || "ไม่ระบุ";
      }
    }

    function renderDashboard() {
      const students       = loadStudents();
      const loggedStudents = loadLoggedStudents();

      const viewsTotal     = parseInt(localStorage.getItem(VIEW_KEY) || "0", 10);
      const loginCount     = parseInt(localStorage.getItem(LOGIN_COUNT_KEY) || "0", 10);

      document.getElementById("viewsTotal").textContent        = viewsTotal;
      document.getElementById("studentsTotal").textContent     = students.length;
      document.getElementById("loggedUsersTotal").textContent  = loggedStudents.length;
      document.getElementById("loginCountTotal").textContent   = loginCount;

      let newTotal = 0, learningTotal = 0, internTotal = 0,
          graduatedTotal = 0, employedTotal = 0;

      students.forEach(s => {
        switch (s.status) {
          case "new":       newTotal++;       break;
          case "learning":  learningTotal++;  break;
          case "intern":    internTotal++;    break;
          case "graduated": graduatedTotal++; break;
          case "employed":  employedTotal++;  break;
        }
      });

      document.getElementById("newTotal").textContent       = newTotal;
      document.getElementById("learningTotal").textContent  = learningTotal;
      document.getElementById("internTotal").textContent    = internTotal;
      document.getElementById("graduatedTotal").textContent = graduatedTotal;
      document.getElementById("employedTotal").textContent  = employedTotal;

      const tbody = document.querySelector("#studentsTable tbody");
      tbody.innerHTML = "";

      students.forEach(s => {
        const tr = document.createElement("tr");

        const tdId   = document.createElement("td");
        const tdName = document.createElement("td");
        const tdCourse = document.createElement("td");
        const tdStatus = document.createElement("td");
        const tdDate   = document.createElement("td");

        tdId.textContent   = s.studentId || "-";
        tdName.textContent = s.fullName || "-";
        tdCourse.textContent = s.course || "-";

        const span = document.createElement("span");
        span.className = statusBadgeClass(s.status);
        span.textContent = statusLabel(s.status);
        tdStatus.appendChild(span);

        tdDate.textContent = s.createdAt ? s.createdAt.substring(0,10) : "-";

        tr.appendChild(tdId);
        tr.appendChild(tdName);
        tr.appendChild(tdCourse);
        tr.appendChild(tdStatus);
        tr.appendChild(tdDate);

        tbody.appendChild(tr);
      });
    }

    window.addEventListener("DOMContentLoaded", renderDashboard);
  </script>
</body>
</html>
